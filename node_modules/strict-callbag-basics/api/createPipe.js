import { subscribe } from "./subscribe.js";
/**
 * Helper for reducing boilerplate when creating operators
 */
export const createPipe = (source, sink, // eslint-disable-line
{ onStart, onData, onEnd, onRequest, onAbort, talkbackOverride, }) => {
    let sub;
    function handleStart() {
        onStart(sub);
    }
    function handleData(data) {
        onData(sub, data);
    }
    sink(0, function startSink(signal, err) {
        if (signal === 1) {
            if (sub === undefined) {
                sub = subscribe(source, {
                    onStart: handleStart,
                    onData: handleData,
                    onEnd,
                    talkbackOverride,
                });
                sub.listen();
            }
            else {
                onRequest(sub);
            }
        }
        else if (2) {
            sub?.cancel();
            onAbort(err);
        }
    });
};
