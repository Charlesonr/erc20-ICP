import { noop } from "../Sink/noop.js";
import { createPipe } from "./createPipe.js";
export const run_ = (self, sink = noop(), ignoreEnd = false) => new Promise((resolve, reject) => {
    createPipe(self, sink, {
        onStart(s) {
            s.pull();
        },
        onRequest(s) {
            s.pull();
        },
        onData(_s, data) {
            sink(1, data);
        },
        onEnd(err) {
            if (err || ignoreEnd === false) {
                sink(2, err);
            }
            if (err) {
                reject(err);
            }
            else {
                resolve();
            }
        },
        onAbort(err) {
            if (err) {
                reject(err);
            }
            else {
                resolve();
            }
        },
    });
});
export const run = (sink, ignoreEnd) => (self) => run_(self, sink, ignoreEnd);
