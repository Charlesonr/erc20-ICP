import { isSuccess } from "@effect/io/Exit";
import { none } from "@effect/io/Fiber/Id";
import { Signal } from "../Source.js";
export const fromEffectOption = (fa) => (r) => (_, sink) => {
    let aborted = false;
    let running = false;
    let cancel;
    sink(Signal.START, (signal) => {
        if (signal === Signal.DATA) {
            if (running)
                return;
            running = true;
            cancel = r.unsafeRunWith(fa, (e) => {
                if (aborted)
                    return;
                if (isSuccess(e)) {
                    if (e.value._tag === "Some") {
                        sink(Signal.DATA, e.value.value);
                    }
                    sink(Signal.END, undefined);
                }
                else {
                    sink(Signal.END, e.cause);
                }
            });
        }
        else if (signal === Signal.END) {
            aborted = true;
            if (cancel) {
                cancel(none)(() => { });
            }
        }
    });
};
//# sourceMappingURL=fromEffectOption.js.map